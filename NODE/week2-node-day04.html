<html>
<head>
  <title>week2-node-day04</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/307027 (zh-CN, DDL); Windows/6.1.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="777"/>
<h1>week2-node-day04</h1>

<div>
<span><div>目标</div><div>    图片的上传<br/></div><div>    <br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="color: rgb(0, 0, 0); font-family: monospace, monospace; font-size: 14.4px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(243, 243, 243);">npm install multer <span style="color: rgb(0, 0, 0); font-family: monospace, monospace; font-size: 14.4px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(243, 243, 243);">--save</span></span></div></div><div>banner.ejs</div><div><img src="week2-node-day04_files/Image.png" type="image/png" data-filename="Image.png"/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;section class=&quot;content-header&quot;&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      &lt;h1&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        轮播图管理</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      &lt;/h1&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      &lt;ol class=&quot;breadcrumb&quot;&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;li&gt;&lt;a href=&quot;#&quot;&gt;&lt;i class=&quot;fa fa-dashboard&quot;&gt;&lt;/i&gt; Level&lt;/a&gt;&lt;/li&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;li class=&quot;active&quot;&gt;Here&lt;/li&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      &lt;/ol&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    &lt;/section&gt;</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    &lt;!-- Main content --&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    &lt;section class=&quot;content&quot;&gt;</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      &lt;!-- Your Page Content Here --&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;div class=&quot;box&quot;&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                &lt;div class=&quot;box-header&quot;&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                    &lt;a href=</span><span style="font-family: Monaco;"><font color="#E30000" style="font-size: 14pt;"><b>'/addBannerRoute</b></font></span><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">'&gt;&lt;button class = &quot;btn btn-xs btn-success&quot;&gt;添加轮播图&lt;/button&gt;&lt;/a&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                &lt;/div&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                &lt;!-- /.box-header --&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                &lt;div class=&quot;box-body no-padding&quot;&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                    &lt;table class=&quot;table table-striped&quot;&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                        &lt;tr&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                            &lt;th&gt;#序号&lt;/th&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                            &lt;th&gt;图片&lt;/th&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                            &lt;th&gt;操作&lt;/th&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                        &lt;/tr&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                        &lt;tr&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                            &lt;td&gt; 1&lt;/td&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                            &lt;td&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                                &lt;img src=&quot;&quot;  style = &quot;height: 50px;width: auto&quot;/&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                            &lt;/td&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                            &lt;td&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                                &lt;button class=&quot;btn btn-xs btn-warning&quot; &gt;编辑&lt;/button&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                                &lt;button class=&quot;btn btn-xs btn-danger&quot; &gt;删除&lt;/button&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                            &lt;/td&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                        &lt;/tr&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                    &lt;/table&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                &lt;/div&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                &lt;!-- /.box-body --&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;/div&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    &lt;/section&gt;</span></div></div><div>定义添加轮播图路由</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">addBannerRoute: ( req, res, next ) =&gt;{</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        res.render('banner_add');</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    },</span></div></div><div>注册路由</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">router.get('/addBannerRoute', banner.addBannerRoute);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><br/></span></div></div><div><br/></div><div><br/></div><div>添加轮播图</div><div><img src="week2-node-day04_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div>banner_add.ejs</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;section class=&quot;content&quot;&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                &lt;div class=&quot;box box-info&quot;&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;div class=&quot;box-header with-border&quot;&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">              &lt;h3 class=&quot;box-title&quot;&gt;Horizontal Form&lt;/h3&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;/div&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;!-- /.box-header --&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;!-- form start --&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;form class=&quot;form-horizontal&quot;</span> <span style="font-family: Monaco;"><font style="font-size: 14pt; color: rgb(227, 0, 0);"><b>enctype = &quot;multipart/form-data&quot; method = &quot;post&quot; action = '/addBannerAction</b></font></span><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">'&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">              &lt;div class=&quot;box-body&quot;&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                &lt;div class=&quot;form-group&quot;&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                  &lt;label for=&quot;bannerid&quot; class=&quot;col-sm-2 control-label&quot;&gt;轮播图id&lt;/label&gt;</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                  &lt;div class=&quot;col-sm-10&quot;&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                    &lt;input type=&quot;text&quot; class=&quot;form-control&quot; name = &quot;</span><span style="font-family: Monaco; font-size: 9pt;"><font color="#FF0000">bannerid</font></span><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&quot; id=&quot;bannerid&quot; placeholder=&quot;轮播图id&quot;&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                  &lt;/div&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                &lt;/div&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                &lt;div class=&quot;form-group&quot;&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                  &lt;label for=&quot;bannerimg&quot; class=&quot;col-sm-2 control-label&quot;&gt;上传图片&lt;/label&gt;</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                  &lt;div class=&quot;col-sm-10&quot;&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt;">                    &lt;input type=&quot;file&quot; class=&quot;form-control&quot; name = &quot;<b><font color="#FF0000">bannerim</font></b>g&quot; id=&quot;bannerimg&quot; &gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                  &lt;/div&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                &lt;/div&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                &lt;div class=&quot;form-group&quot;&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                  &lt;label for=&quot;&quot; class=&quot;col-sm-2 control-label&quot;&gt;展示图片&lt;/label&gt;</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                  &lt;div class=&quot;col-sm-10&quot;&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                    &lt;img src = &quot; &quot;  style=&quot;width:100px;height:auto;&quot;/&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                  &lt;/div&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                &lt;/div&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                                &lt;div class=&quot;form-group&quot;&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                                    &lt;label for=&quot;bannerurl&quot; class=&quot;col-sm-2 control-label&quot;&gt;链接地址&lt;/label&gt;</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                                    &lt;div class=&quot;col-sm-10&quot;&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                                        &lt;input type=&quot;url&quot; class=&quot;form-control&quot; name = &quot;</span><span style="font-family: Monaco; font-size: 9pt;"><font color="#FF0000">bannerurl</font></span><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&quot; id=&quot;bannerurl&quot; placeholder=&quot;链接地址&quot;&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                                    &lt;/div&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                                &lt;/div&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">              &lt;/div&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">              &lt;!-- /.box-body --&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">              &lt;div class=&quot;box-footer&quot;&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                                &lt;div class=&quot;form-group&quot;&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                                        &lt;label for=&quot;castsalt&quot; class=&quot;col-sm-2 control-label sr-only&quot;&gt;alt&lt;/label&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    </span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                                        &lt;div class=&quot;col-sm-10&quot;&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                                            &lt;input type=&quot;submit&quot;class=&quot;btn btn-info&quot; value = &quot;添加&quot;/&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                                        &lt;/div&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                                    &lt;/div&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">              &lt;/div&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">              &lt;!-- /.box-footer --&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;/form&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">          &lt;/div&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">     &lt;/section&gt;</span></div></div><div>定义路由<span style="font-family: Monaco; color: rgb(227, 0, 0); font-size: 14pt; font-weight: bold;">addBannerAction， 文件会存放在req.file或者req.files中，文本信息放在req.body中</span></div><div><font color="#E30000" face="Monaco"><span style="font-size: 18.6667px;"><b>上传完成得到图片信息只有名字（唯一的filename）,后缀需要通过req.file.<span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51); font-weight: bold;">mimetype获取，以/分割去1，通过fs.rename方法改变名字，原路径为<span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51); font-weight: bold;">&quot;./uploads/&quot; + req.file.filename;改变后为<span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51); font-weight: bold;">&quot;./uploads/&quot; + <span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51); font-weight: bold;">req.file.filename + &quot;.&quot; + req.file.mimetype.split('/')[1];，使用串行有关联，将路径传递给下一个函数，下一个函数是连接数据库函数，继续传值给第三个函数插入数据库，最终得到结果</span></span></span></span></b></span></font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">addBannerAction: ( req, res, next ) =&gt;{</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">//         console.log( req.file )</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">//         console.log( req.body )</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        var bannerimg = req.file.filename + &quot;.&quot; + req.file.mimetype.split('/')[1];</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        </span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        var oldname = &quot;./uploads/&quot; + req.file.filename;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        var newname = &quot;./uploads/&quot; + bannerimg</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">       </span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">       async.waterfall( [</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">           ( cb ) =&gt; {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">               fs.rename( oldname, newname, ( err, data ) =&gt; {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                    if ( err ) throw err;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                     cb( null, bannerimg );</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                })</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">           },</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">           ( bannerimg, cb ) =&gt; {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">               MongoClient.connect( mongourl, ( err, db ) =&gt; {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">               if ( err ) throw err;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                    console.log(&quot;bannerimg----&quot;, bannerimg );</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                    cb( null, bannerimg, db );</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">               })</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">           },</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">           ( bannerimg, db, cb ) =&gt; {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">               console.log(&quot;bannerimg+++++&quot;, bannerimg)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">               var { bannerid, bannerurl } = req.body;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">               var insertObj = {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                   bannerimg,</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                   bannerid,</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                   bannerurl</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">               }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">               console.log(insertObj)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                db.collection('banner').insert( insertObj, ( err, data ) =&gt; {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                    if ( err ) throw err;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                    cb( null, &quot;ok&quot;);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                    db.close();</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                })</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">           }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">       ], ( err, result ) =&gt; {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">           if ( err ) throw err;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">           if( result == &quot;ok&quot;){</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">               res.redirect('/banner')</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">           }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">           </span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">       })</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        /**</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">         *</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">         </span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">         { fieldname: 'bannerimg',</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  originalname: '党员教育培训.jpg',</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  encoding: '7bit',</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  mimetype: 'image/jpeg',</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  destination: 'uploads/',</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  filename: 'b752dbc2856609d250de6d10577f4292',</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  path: 'uploads\\b752dbc2856609d250de6d10577f4292',</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  size: 44683 }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">{ banerid: '111', banerurl: '</span><a href="http://www.aaa.com/" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">http://www.aaa.com</a><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">' }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">         */</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    },</span></div></div><div>注册路由：注意第二个参数为上传文件时必须写的参数</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">router.post('/addBannerAction',</span> <span style="font-family: Monaco;"><font color="#E30000" style="font-size: 16pt;"><b>upload.single('bannerimg')</b></font></span><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">, banner.addBannerAction);</span></div></div><div>渲染列表......</div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></span>
</div></body></html> 